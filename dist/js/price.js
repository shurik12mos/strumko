$(window).ready(function(){$.getJSON("api/pricelist.json",function(t){$.each(t,function(e,o){if(0!=e&&o["раздел"]==t[e-1]["раздел"]){var r="<tr><td>"+o["Наименование"]+"</td><td>"+o["еденицы измерения"]+"</td><td>"+o["Стоимость"]+"</td></tr>";$(".table_price").append(r)}else{var r="<tr><td colspan='3'>"+o["раздел"]+"</td></tr>",r=r+"<tr><td>"+o["Наименование"]+"</td><td>"+o["еденицы измерения"]+"</td><td>"+o["Стоимость"]+"</td></tr>";$(".table_price").append(r)}"8.2.2"==o["артикул"]&&$(".price p").eq(1).text("").text(o["Стоимость"]+" грн"),"2.5.1"==o["артикул"]&&$(".price p").eq(3).text("").text(o["Стоимость"]+" грн"),"7.1.1"==o["артикул"]&&$(".price p").eq(5).text("").text(o["Стоимость"]+" грн"),"11.1.1"==o["артикул"]&&$(".price p").eq(7).text("").text(o["Стоимость"]+" грн"),"1.1.1"==o["артикул"]&&$(".price p").eq(9).text("").text(o["Стоимость"]+" грн"),"15.1.1"==o["артикул"]&&$(".price p").eq(11).text("").text(o["Стоимость"]+" грн")})})}),$(window).ready(function(){function t(t){function e(t){function e(t){return t=t.replace(/,/g,"."),t=t.replace(/[^\.0-9]/g,""),t=parseFloat(t)}var r,n,a,c,i,d,s,p,l,u=!1,m=!1,h=[];$.each(t,function(_,f){var $=f.content.$t,g=f.gs$cell;switch($.toLowerCase()){case"монтажные работы":e(t[_+1].content.$t)>0&&0==o.sum_jobs&&(l=t[_+1].content.$t,l=e(l).toFixed(2),o.sum_jobs=l);break;case"материалы":e(t[_+1].content.$t)>0&&0==o.sum_materials&&(l=t[_+1].content.$t,l=e(l).toFixed(2),o.sum_materials=l);break;case"итого":e(t[_+1].content.$t)>0&&0==o.sum&&(l=t[_+1].content.$t.replace(",",".").replace(" ",""),l=e(l).toFixed(2),o.sum=l);break;case"трудозатраты:":""!=t[_+1].content.$t&&0==o.human_hour&&(l=t[_+1].content.$t.replace(",",".").replace(" ",""),l=e(l),o.human_hour=l,m=!0);break;case"Проект:":""!=t[_+1].content.$t&&""==o.designer&&(o.designer=t[_+1].content.$t)}$.toLowerCase().indexOf("наименование")===-1||u||(r=g.col,n=g.row),$.toLowerCase().indexOf("наименование")!==-1&&u&&r===g.col&&(a=g.row),$.toLowerCase().indexOf("артикул работы")===-1||u||n!==g.row||(c=g.col),$.toLowerCase().indexOf("ед.изм.")===-1||u||n!==g.row||(i=g.col),$.toLowerCase().indexOf("кол-во")===-1||u||n!==g.row||(d=g.col),$.toLowerCase().indexOf("ст.ед.")===-1||u||n!==g.row||(s=g.col),$.toLowerCase().indexOf("сумма")===-1||u||n!==g.row||(p=g.col,u=!0),h[g.row]&&h[g.row].length?h[g.row][g.col]=g:(h[g.row]=[],h[g.row][g.col]=g)}),h.forEach(function(t,l){var u={};l>n&&l<a&&t[s]&&""!==t[r].$t&&(u={name:t[r].$t,code:t[c].$t,measure:t[i].$t,number:e(t[d].$t),price:e(t[s].$t),sum:e(t[p].$t)},o.jobs.push(u))}),h.forEach(function(t,n){var c={};n>a&&t[s]&&""!==t[r].$t&&(c={name:t[r].$t,measure:t[i].$t,number:e(t[d].$t),price:e(t[s].$t),sum:e(t[p].$t)},o.materials.push(c))})}var o={object:"",contractor:'ООО "Струмко" т.(099)049 39 11, (067)708 15 36',designer:"",sum:0,sum_jobs:0,sum_materials:0,human_hour:0,materials:[],jobs:[]};return e(t),o}function e(){function e(e){function n(){s+=1,s>=p&&r.resolve(o)}function d(e){if(e.spreadSheet&&"string"==typeof e.spreadSheet){var r,d,s;d=e.spreadSheet.indexOf("/d/")+3,s=e.spreadSheet.indexOf("/",d),r=e.spreadSheet.slice(d,s),r=c+r+i,$.getJSON(r,function(c){var i=t(c.feed.entry);i.name=e.name,i.object=e.name,i.image=a+e.image,i.description=e.description,i.spreadSheet=r,o.push(i),n()},function(t){n()})}else n()}for(var s=0,p=e.length,l=0;l<p;l++)d(e[l])}var o=[],n="api/type_project.json",a="images/type_project/",c="http://spreadsheets.google.com/feeds/cells/",i="/4/public/values?alt=json";$.getJSON(n,function(t){console.log("done type_project ",t),e(t)},function(t){console.log("error",t)})}function o(t){function e(){function e(t,e){var r=0,n=0,a=0,c="<tr><th>№</th><th>Наименование</th><th>ед.изм.</th><th>кол-во</th><th>ст.ед., грн</th><th>сумма, грн</th></tr>";t&&t.length&&(t.forEach(function(t,e){c+="<tr><td>"+(e+1)+"</td><td>"+t.name+"</td><td>"+t.measure,c+="</td><td>"+t.number+"</td><td>"+t.price.toFixed(2)+"</td><td>"+t.sum.toFixed(2)+"</td></tr>",r+=t.sum}),r=Math.round(100*r)/100,e.hasClass("table_jobs")?(n=Math.round(.2*r*100)/100,c+="<tr><td></td><td colspan = '4'>Запас на работы (не используемая часть возвращается)</td><td>"+n+"</td></tr>",r+=n,c+="<tr><td></td><td colspan = '4'>Итого строительно-монтажные и пусконаладочные работы</td><td>"+o.sum_jobs+"</td></tr>"):e.hasClass("table_materials")&&(n=n=Math.round(.2*r*100)/100,c+="<tr><td></td><td colspan = '4'>Запас на материалы  (не используемая часть возвращается)</td><td>"+(r=Math.round(.2*r*100)/100)+"</td></tr>",r+=n,a=Math.round(.1*r*100)/100,c+="<tr><td></td><td colspan = '4'>Расходы по оформлению и доставке материалов</td><td>"+a+"</td></tr>",c+="<tr><td></td><td colspan = '4'>Итого материалы</td><td>"+o.sum_materials+"</td></tr>"),e.empty(),e.append(c))}var o=t[$(this).data("number")],r=$("#type_project_modal"),n=$("#type_project_object"),a=$("#type_project_designer"),c=$("#type_project_modal .type_project_modal_summary_jobs>span"),i=$("#type_project_modal .type_project_modal_summary_materials>span"),d=$("#type_project_modal .type_project_modal_summary_all>span"),s=$("#type_project_modal .type_project_modal_table_hh>span"),p=$("#type_project_modal .type_project_modal_jobs>table"),l=$("#type_project_modal .type_project_modal_materials>table");n.text(o.name),o.designer=o.designer||"Виктор т. (096)497 04 85",a.text(o.designer),c.text(o.sum_jobs),i.text(o.sum_materials),d.text(o.sum),s.text(o.human_hour+"чел*час"),e(o.jobs,p),e(o.materials,l),r.slideDown(500)}function o(e){if(d=$("#type_project .type_project_item"),a=d.width(),i=parseFloat(d.css("paddingLeft")),i+=parseFloat(d.css("paddingRight")),!e){var o=p.width();e=o>992?4:o>640&&o<=992?2:1}c=p.width()/e,s=d.width(c-i).height(),$("#type_project .itemBlock").width(t.length*c),$("#type_project").height(s)}function r(t){t&&(g="changedTouches"in t?t.changedTouches[0].clientX||t.changedTouches[0].pageX:t.clientX||t.pageX)}function n(t){t&&(j="changedTouches"in t?t.changedTouches[0].clientX||t.changedTouches[0].pageX:t.clientX||t.pageX,g-j>30?u.click():g-j<-30&&l.click())}t.forEach(function(t,e){var o="";o='<div class="type_project_item col-md-3 col-sm-6 col-xs-12" >\n',o+='\t<div class="type_project_img">\n',o+='\t\t<img src = "'+t.image+'" alt = "'+t.name+'"/> \n',o+='\t\t<div class="type_project_img_more sliding fromtop"  data-number = "'+e+'"><span><i class="fa fa-ellipsis-h" aria-hidden="true"></i>Подробней</span></div> \n',o+="\t</div> \n",o+='\t<div class="type_project_description">'+t.description+"</div> \n",o+='\t<div class="type_project_name">'+t.name+"</div> \n",o+='\t<div class="type_project_line"></div> \n',o+='\t<div class="type_project_price">'+parseInt(t.sum_jobs).toLocaleString()+" грн</div> \n",o+="</div> \n",$("#type_project .itemBlock").append(o)});var a,c,i,d,s,p,l,u,m,h=0,_=!0;p=$("#type_project"),l=$(".type_project .left"),u=$(".type_project .right"),m=$("#type_project .itemBlock"),o(),u.click(function(){_&&(h-=c,console.log("widthItem",c,"left",h),m.width()+h<p.width()&&(h=0),_=!1,m.animate({left:h+"px"},700,function(){_=!0}))}),l.click(function(){_&&(h+=c,h>0&&(h=p.width()-m.width()),_=!1,m.animate({left:h+"px"},700,function(){_=!0}))}),$(window).resize(function(){var t=$(window).width();t>=1200?(m.animate({left:"0px"},500),o(4),h=0,l.css({left:"-20px",backgroundColor:"transparent",borderRadius:"50%"}),u.css({right:"-20px",backgroundColor:"transparent",borderRadius:"50%"})):t>640&&t<1200?(m.animate({left:"0px"},500),o(2),h=0,l.css({left:0,backgroundColor:"#fff",borderRadius:"50%"}),u.css({right:0,backgroundColor:"#fff",borderRadius:"50"})):(m.animate({left:"0px"},500),o(1),h=0,l.css({left:0,backgroundColor:"#fff",borderRadius:"50%"}),u.css({right:0,backgroundColor:"#fff",borderRadius:"50"}))});var f=document.getElementById("type_project"),g=0,j=0;f.addEventListener("touchstart",r,!1),f.addEventListener("touchend",n,!1),$("#type_project .type_project_img_more").on("click",e),$("#type_project_modal .type_project_modal_dismiss").on("click",function(){$("#type_project_modal").slideUp(500)})}var r=$.Deferred();r.then(function(t){o(t),$(".spinner").hide()},function(t){}),e(),$("#printIt").on("click",function(){var t=[],e=[],o=$("#printIt").attr("data-target");o=$(o).children().clone(),$("body >*").each(function(o,r){$(this).css&&"none"!==$(this).css("display")?(t.push($(this)),$(this).hide()):e.push($(this))}),$("body").append(o),o.css({maxWidth:"100%",zIndex:1e4}),$(o).show(),setTimeout(function(){function e(){$(o).remove(),t.forEach(function(t){t.show()})}window.print(),setTimeout(e,0)},0)})});